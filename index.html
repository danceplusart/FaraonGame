function takePuff() {
    let puffCount = turboActive ? 10 : 1;
    let progressGain = 8 * puffCount;
    
    puffs += puffCount;
    progress += progressGain;
    
    if (turboActive && puffCount > 1) {
        scrolls = Math.max(0, scrolls - 3);
    }
    
    if (progress >= 100) {
        let earned = Math.floor(progress / 100);
        scrolls += earned;
        progress = progress % 100;
        gameMessage.textContent = `✨ +${earned} свитков! ✨`;
    }
    
    if (progress > 100) progress = 100;
    
    updateUI();
    
    // Сохраняем после каждого действия
    localStorage.setItem('pharaoh_puffs', puffs);
    localStorage.setItem('pharaoh_scrolls', scrolls);
    localStorage.setItem('pharaoh_wins', wins);
    localStorage.setItem('pharaoh_discounts', discounts);
    localStorage.setItem('pharaoh_progress', progress);
    
    puffBtn.style.transform = 'scale(0.95)';
    setTimeout(() => puffBtn.style.transform = '', 100);
}
